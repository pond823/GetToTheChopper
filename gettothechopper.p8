pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
--get to the chopper
--by sasha bilton

-- global variables

game = {}
game.state = 1
game.timer = 1
sprites = {}
player = {}
bullets = {}

function _init()

  player.sprite = new_sprite(64,100,5,{1,2},1,0,0)

end

function _update()
    update_timer()
    foreach(sprites, update_sprite)
  	if (game.state == 1) update_start_screen()
    if (game.state == 2) update_game_screen()
end

function _draw()
	cls()
  	if (game.state == 1) draw_start_screen()
    if (game.state == 2) draw_game_screen()
end

--
-- update functions
--
function update_start_screen()
  if (btnp(5)) game.state = 2
end

function update_game_screen()
  foreach(bullets, update_bullet)
  if (btn(0)) then 
    if (player.sprite.x>1) player.sprite.x-=1
  end
  if (btn(1)) then
    if (player.sprite.x<128) player.sprite.x+=1
  end
  if (btnp(5)) shoot_gun()
end

function update_bullet(bullet)
  bullet.y-=3
  if (bullet.y <0) del(bullets,bullet)
end


function shoot_gun()
  bullet = new_sprite(player.sprite.x, player.sprite.y,{16},1,0,0)
  add(bullets,bullet)
  log("Shoot_gun "..count(bullets)..bullet.x.."/"..bullet.y)
end


--
-- draw functions
--
function draw_start_screen()
    print ("get to the chopper", 0,10)
    print ("press ❎ to start", 0,20)
end
function draw_game_screen()
  print ("get ready", 0,10)
  foreach(sprites, sprite_draw)
end

--
-- sprite code
--
function new_sprite(x1, y1,tick, list, active, oneshot, move)
 s = {}
 s.x = x1
 s.y = y1
 s.list = list
 s.current = 1
 s.tick = tick -- change sprite frame every n refreshes (max 60)
 s.active = active -- is the sprite active?
 s.oneshot = oneshot -- does the sprite die 
 s.first_update = 1 -- marks the sprite as fresh
 s.move = move -- sprite moves
 add (sprites, s)
 return s
end


function sprite_draw(sprite)
  if (sprite.active == 1) then
    spr(sprite.list[sprite.current],sprite.x,sprite.y)

  end
end

function update_sprite(sprite)
  if (sprite.active ==1) then
    if (sprite.first_update !=1 
      and sprite.move == 1 ) then
    sprite.x -= game.dx*8
    sprite.y -= game.dy*8
    sprite.first_update = 0
  else
    sprite.first_update = 0
  end
 -- check to see if we're on a tick
 if (game.timer % sprite.tick == 1) then
  if (sprite.current < #sprite.list) then
    sprite.current+=1
  else
    sprite.current =1
    if (sprite.oneshot == 1) then
      del(sprites,sprite)
    end
  end
 end
end
end

function update_timer()
  game.timer+=1
  if (game.timer>60) then
    game.timer = 1
  end

end

--
-- end of sprite code
--

function log(msg)
	printh(time()..":"..msg, "log.txt")
end



__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000990000009900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000003993f00f39930000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007000f333300003333f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000003300000000330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
60000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000b30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33b0b300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00333000003b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000353b0000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00b30030000000b30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00300030000000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
